<canvas id="ctx" width="500" height="800" style="border:3px solid #000000;"></canvas>

<script>
var ctx = document.getElementById("ctx").getContext("2d");
ctx.font = '60px Courier New';

var HEIGHT = 800;
var WIDTH = 500;

var player;
var enemy;

var bulletList = {};

createPlayer = function(){

	player = {
		x:220,
		y:780,
		width:60,
		height:20,
		pressingKey:false,
		modNum:0,
	};
}

createEnemy = function(){

	enemy = {
		x:225,
		y:200,
		radius:50,
		number:9,
	};
}

Bullet = function(x,y,spdX,spdY,radius,number){

	var bullet = {
		id:Math.random(),
		x:x,
		y:y,
		spdX:spdX,
		spdY:spdY,
		radius:radius,
		number:number,
	};
	
	bulletList[bullet.id] = bullet;
}

generateBullet = function(actor){

	Bullet(actor.x, actor.y, 0, -15, 50, actor.modNum);
	//Bullet(100, actor.y, 0, -15, 50, actor.modNum);
}

update = function(){

	ctx.clearRect(0,0,WIDTH,HEIGHT);
	updatePlayer();
	updateEnemy();
	
	for(var key in bulletList)
	{
		updateBullet(bulletList[key]);
		
		var toRemove = false;
		
		if(testCollisionCircle(enemy, bulletList[key]))
		{
			console.log("colliding! " + bulletList[key].number);
			enemy.number = enemy.number % bulletList[key].number;
			toRemove = true;
		}
		
		if(bulletList[key].y < 0)
		{
			console.log("out of bounds " + bulletList[key].number);
			toRemove = true;
		}
		
		if(toRemove){
			delete bulletList[key];
		}
	}
}

updatePlayer = function(){

	drawPlayer();
	
}

updateEnemy = function(){
	drawEnemy();
}

updateBullet = function(bullet){

	bullet.x += bullet.spdX;
	bullet.y += bullet.spdY;
	drawBullet(bullet);
}

drawPlayer = function(){

	ctx.fillRect(player.x, player.y, player.width, player.height);

}

drawEnemy = function(){

	var text = enemy.number;
	var width = ctx.measureText(text).width;
	ctx.fillText(text, enemy.x-(width/2), enemy.y+20);
	
	ctx.beginPath();
	ctx.arc(enemy.x, enemy.y, 50, 0, 2*Math.PI);
	ctx.closePath();
	ctx.stroke();
}

drawBullet = function(bullet){
	
	
	
	var text = bullet.number;
	var width = ctx.measureText(text).width;
	ctx.fillText(text, bullet.x-(width/2), bullet.y+20);
	
	ctx.beginPath();
	ctx.arc(bullet.x, bullet.y, bullet.radius, 0, 2*Math.PI);
	ctx.closePath();
	ctx.stroke();
}

document.onkeydown = function(event){
	player.pressingKey = true;
}

document.onkeyup = function(event){
	player.pressingKey = false;
	switch(event.keyCode){
		case 49 || 97:
			player.modNum = 1;
			break;
		case 50 || 98:
			player.modNum = 2;
			break;
		case 51 || 99:
			player.modNum = 3;
			break;
		case 52 || 100:
			player.modNum = 4;
			break;
		case 53 || 101:
			player.modNum = 5;
			break;
		case 54 || 102:
			player.modNum = 6;
			break;
		case 55 || 103:
			player.modNum = 7;
			break;
		case 56 || 104:
			player.modNum = 8;
			break;
		case 57 || 105:
			player.modNum = 9;
			break;
		default:
			startNewGame();
	}	
	
	console.log('press!' + player.modNum);
	
	generateBullet(player);
}

testCollisionCircle = function(cir1, cir2){
	return cir1.x <= cir2.x+cir2.radius
		&& cir2.x <= cir1.x+cir1.radius
		&& cir1.y <= cir2.y+cir2.radius
		&& cir2.y <= cir1.y+cir1.radius
}

startNewGame = function(){
	createPlayer();
	createEnemy();
}

startNewGame();
setInterval(update, 40);
</script>